# Metrics

### Web application which allows users to create multiple metric and post values to that metric

## Project Description
Web API supports the following actions:
* Create a Metric - Time complexity O(1)
* Post Values to a Metric - Time complexity O(1)
* Retrieve Statistics including:
  - Arithmetic Mean of a values posted to metric - Time complexity O(1)
  - Median of a values posted to metric - Time complexity O(1)
  - Min value for metric - Time complexity O(1)
  - Max value for metric - Time complexity O(1)
## API documentation
### Create a Metric
endpoint: /api/createmetric
request body:
```
{ 
  metricName: 'anyString'
}
```
### Post Values to a Metric

## Technology
All API features are O(1) time complexity. It is also O(1) space complexity.
### O(1) time complexity
The input value are sorted indirectly using min-heap, max-heap, median-heap(made of half min-heap and half max-heap)
### O(1) space complexity
The data struction of the 'Neo' metric looks like this.
```
{ Neo:
{ name: 'Neo',
  sum: 67,
  content: 
   { '0': { value: 12 },
     '1': { value: 20 },
     '2': { value: 25 },
     '3': { value: 10 } },
  autoGeneratedKey: 3,
  minHalfHeap: { content: [ 1, 2 ], compareFunction: [Function] },
  maxHalfHeap: { content: [ 0, 3 ], compareFunction: [Function] },
  minHeap: { content: [ 3, 0, 2, 1 ], compareFunction: [Function] },
  maxHeap: { content: [ 2, 0, 1, 3 ], compareFunction: [Function] } },
  ...
  }
```
The sorting heap only save a copy of the index for conent. It takes the contents as arguement when it performs the soring. For scalability, the value can be very big, it saves space by only copying the index only. 
### Handle errors
Covers following errors
* Used Express middleware to handle all input type error
* If the metric name does exist, server will either create a metric or respond warning. No error will occur. 


## Usage
Intial installation
```
npm install
```
Run test
```
npm test
```
Start server
```
npm start
```
## Deploy instruction
In terminal type in user-name followed by ip address
```
ssh <user-name>@<ip-address-of-the-server-you-want-to-log-into>
```
Then, enter password
navigate to folder, or create an folder
```
mkdir codeChallenge && cd codeChallenge
```
clone this repo
```
git clone https://github.com/michaelbdai/Metrics
```
install indepedency and start the server
```
npm install
npm start
```
## Test coverage
```
  Test for Metrics coding challenge: 
    BinaryHeapIndex helper function 
      ✓ should be a function
      ✓ should inserted 6 element
      ✓ should get Min from the top parent of min-heap
      ✓ should get new min after pop
    Metric helper function
      ✓ should be a function
      ✓ should inserted 6 element
      ✓ should get smallest number from min function
      ✓ should get largest number from max function
      ✓ should get middle half from median function
      ✓ should get average value from average function
    Create a Metric
      ✓ should create new metric if there is not duplicate (54ms)
      ✓ should not overwrite existing metric, if attempt to create existing metric
    Post values to a Metric​
      ✓ should insert a value
      ✓ should create and metric and insert a value if the metric name is new
      ✓ should be able to insert multiple values
    Retrieve statistics data
      ✓ should retrieve statistics data
      ✓ should respond with error message if the metric name does not exist
    Handle Error
      ✓ should respond 400 if metric name is not string
      ✓ should respond 400 if post value is not a number or array
      ✓ should respond 400 if post value is array, which contains non-number element
      ✓ should respond 400 if missing parameter for post value
      ✓ should respond 400 if missing parameter for create metric
      ✓ should respond 400 if missing parameter for retrieving statistics
      ✓ should respond 404 if the endpoint is incorrect
```
